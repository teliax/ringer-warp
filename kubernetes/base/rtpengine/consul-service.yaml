apiVersion: v1
kind: ConfigMap
metadata:
  name: rtpengine-consul-config
  namespace: warp-v01
data:
  rtpengine.json: |
    {
      "service": {
        "name": "rtpengine",
        "tags": [
          "media",
          "rtp",
          "srtp",
          "webrtc",
          "transcoding"
        ],
        "port": 2223,
        "meta": {
          "version": "11.0.0",
          "protocol": "ng",
          "capabilities": "webrtc,recording,transcoding,dtls,srtp"
        },
        "check": {
          "id": "rtpengine-health",
          "name": "RTPEngine Health Check",
          "tcp": "localhost:2223",
          "interval": "10s",
          "timeout": "2s"
        },
        "checks": [
          {
            "id": "rtpengine-metrics",
            "name": "RTPEngine Prometheus Metrics",
            "http": "http://localhost:9101/metrics",
            "interval": "30s",
            "timeout": "5s"
          },
          {
            "id": "rtpengine-cli",
            "name": "RTPEngine CLI Interface",
            "tcp": "localhost:9900",
            "interval": "30s",
            "timeout": "2s"
          }
        ],
        "connect": {
          "sidecar_service": {
            "port": 2223,
            "proxy": {
              "upstreams": [
                {
                  "destination_name": "redis",
                  "local_bind_port": 6379
                },
                {
                  "destination_name": "kamailio",
                  "local_bind_port": 5060
                }
              ],
              "config": {
                "protocol": "tcp"
              }
            }
          }
        }
      }
    }
  
  rtpengine-sidecar.json: |
    {
      "service": {
        "name": "rtpengine-sidecar-proxy",
        "port": 21000,
        "connect": {
          "sidecar_service": {
            "proxy": {
              "destination_service_name": "rtpengine",
              "destination_service_id": "rtpengine",
              "local_service_address": "127.0.0.1",
              "local_service_port": 2223
            }
          }
        }
      }
    }