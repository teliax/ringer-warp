# Install cert-manager-webhook-gandi for DNS-01 challenges
# This is required for wildcard certificates with Gandi DNS
#
# Install using Helm:
# helm repo add bwolf https://bwolf.github.io/cert-manager-webhook-gandi
# helm install cert-manager-webhook-gandi \
#   --namespace cert-manager \
#   --set features.apiPriorityAndFairness=true \
#   --set logLevel=2 \
#   --set groupName=acme.bwolf.me \
#   bwolf/cert-manager-webhook-gandi

---
# Manual installation manifest
apiVersion: v1
kind: ServiceAccount
metadata:
  name: cert-manager-webhook-gandi
  namespace: cert-manager
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cert-manager-webhook-gandi
rules:
  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - get
  - apiGroups:
      - acme.bwolf.me
    resources:
      - "*"
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cert-manager-webhook-gandi
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cert-manager-webhook-gandi
subjects:
  - kind: ServiceAccount
    name: cert-manager-webhook-gandi
    namespace: cert-manager
---
# The webhook deployment and service are complex
# It's recommended to use the Helm chart for installation:
# helm install cert-manager-webhook-gandi bwolf/cert-manager-webhook-gandi -n cert-manager