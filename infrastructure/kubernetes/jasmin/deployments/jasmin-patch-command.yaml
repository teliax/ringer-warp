apiVersion: apps/v1
kind: Deployment
metadata:
  name: jasmin-smsc
  namespace: messaging
spec:
  template:
    spec:
      containers:
      - name: jasmin
        command: ["/bin/bash", "-c"]
        args:
        - |
          # Create necessary directories
          mkdir -p /var/log/jasmin /var/run/jasmin
          
          # Start Jasmin with the configuration
          echo "Starting Jasmin..."
          jasmind.py --config /config/jasmin.cfg &
          
          # Wait for Jasmin to start
          echo "Waiting for Jasmin to start..."
          sleep 30
          
          # Initialize Jasmin configuration
          if [ -f /config/init-jasmin.sh ]; then
            echo "Running initialization script..."
            /config/init-jasmin.sh
          fi
          
          # Keep container running by tailing logs
          echo "Jasmin started. Tailing logs..."
          touch /var/log/jasmin/jasmin.log
          tail -f /var/log/jasmin/jasmin.log